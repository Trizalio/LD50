[gd_scene load_steps=11 format=2]

[ext_resource path="res://icon.png" type="Texture" id=1]
[ext_resource path="res://resources/shaders/star_shader_material.tres" type="Material" id=2]
[ext_resource path="res://resources/shaders/planet_shader_material.tres" type="Material" id=3]
[ext_resource path="res://planet.tscn" type="PackedScene" id=4]
[ext_resource path="res://system_map.gd" type="Script" id=5]
[ext_resource path="res://resources/fonts/Roboto_Mono/RobotoMono-VariableFont_wght.ttf" type="DynamicFontData" id=6]

[sub_resource type="Shader" id=10]
code = "shader_type canvas_item;
uniform sampler2D star_positions;
uniform int stars_amount;
uniform vec2 shift = vec2(0.);
uniform float first_zone_range = 0.3;
uniform float second_zone_range = 0.6;
uniform float lighten_power = .1;
uniform float border_width = .05;
uniform float border_lighten_power = .1;
uniform vec4 first_zone_color: hint_color = vec4(0., 0., 1., .01);
uniform vec4 second_zone_color: hint_color = vec4(0., 1., .3, .01);

vec4 lighten(vec4 color, float power){
	vec4 missing_color = vec4(1.) - color;
	vec4 result = color + missing_color * power;
	return result;
}
vec4 mix_colors(vec4 first, vec4 second){
	vec4 result = first * (1. - second.a) + second;
	return result;
}

vec2 get_position(int star_index){
    vec4 tex = texelFetch(star_positions, ivec2(star_index, 0), 0);
	vec2 result = (tex.xy - vec2(0.5)) * 2.0;
	return result;
}

vec4 get_color_for_zone(float range, float zone_range, vec4 zone_color){
	vec4 result = vec4(0);
	if (range < zone_range){
		float d_range = zone_range - range;
		result = zone_color;
		result = lighten(result, d_range * lighten_power);
		if (d_range < zone_range * border_width){
			result = lighten(result, border_lighten_power);
		}
	}
	return result;
}

void fragment(){
	vec2 uv = (UV - vec2(0.5)) * 2.;
	COLOR = vec4(0.);
	float min_range = 2.;
 	for(int i = 0; i < stars_amount; ++i){
		vec2 position = get_position(i);
		float current_range = distance(uv, position + shift);
		min_range = min(min_range, current_range);
	}
	vec4 first_zone = get_color_for_zone(min_range, first_zone_range, first_zone_color);
	vec4 second_zone = get_color_for_zone(min_range, second_zone_range, second_zone_color);
	COLOR = mix_colors(second_zone, first_zone);
//	COLOR = mix_colors(first_zone, second_zone);
//	if (min_range < first_zone_range){
//		float d_range = range - min_range;
//		COLOR = first_zone;
//		COLOR = lighten(COLOR, d_range * lighten_power);
//		if (d_range < range * border_width){
//			COLOR = lighten(COLOR, border_lighten_power);
//		}
//	}
}"

[sub_resource type="ShaderMaterial" id=13]
shader = SubResource( 10 )
shader_param/stars_amount = null
shader_param/shift = Vector2( 0, 0 )
shader_param/first_zone_range = 0.3
shader_param/second_zone_range = 0.6
shader_param/lighten_power = 0.1
shader_param/border_width = 0.05
shader_param/border_lighten_power = 0.1
shader_param/first_zone_color = Color( 0, 0, 1, 0.01 )
shader_param/second_zone_color = Color( 0, 1, 0.3, 0.01 )

[sub_resource type="DynamicFont" id=11]
size = 72
font_data = ExtResource( 6 )

[sub_resource type="DynamicFont" id=12]
size = 72
font_data = ExtResource( 6 )

[node name="system_map" type="Node2D"]
script = ExtResource( 5 )

[node name="base" type="Node2D" parent="."]
position = Vector2( 700, 450 )

[node name="root" type="Node2D" parent="base"]

[node name="star" type="Sprite" parent="base/root"]
visible = false
material = ExtResource( 2 )
scale = Vector2( 4, 4 )
texture = ExtResource( 1 )

[node name="mars" type="Sprite" parent="base/root"]
visible = false
material = ExtResource( 3 )
position = Vector2( 196.838, 139.504 )
scale = Vector2( 2, 2 )
texture = ExtResource( 1 )

[node name="planet" parent="base/root" instance=ExtResource( 4 )]
visible = false
position = Vector2( -63.4048, 202.228 )

[node name="marks" type="Node2D" parent="base/root"]

[node name="sprite" type="Sprite" parent="base/root/marks"]
material = SubResource( 13 )
scale = Vector2( 22, 22 )
texture = ExtResource( 1 )

[node name="contols" type="MarginContainer" parent="."]
visible = false
margin_left = 900.0
margin_right = 1400.0
margin_bottom = 900.0
custom_constants/margin_right = 25
custom_constants/margin_top = 75
custom_constants/margin_left = 25
custom_constants/margin_bottom = 25
__meta__ = {
"_edit_use_anchors_": false
}

[node name="buttons" type="VBoxContainer" parent="contols"]
margin_left = 25.0
margin_top = 75.0
margin_right = 475.0
margin_bottom = 875.0
custom_constants/separation = 50
alignment = 1

[node name="buttons" type="Control" parent="."]
margin_left = 1000.0
margin_top = 490.0
margin_right = 1000.0
margin_bottom = 490.0
__meta__ = {
"_edit_use_anchors_": false
}

[node name="info" type="Control" parent="."]
margin_right = 40.0
margin_bottom = 40.0
mouse_filter = 2
__meta__ = {
"_edit_use_anchors_": false
}

[node name="title" type="Label" parent="info"]
modulate = Color( 1, 1, 1, 0 )
margin_left = 277.031
margin_top = 81.274
margin_right = 664.031
margin_bottom = 177.274
custom_fonts/font = SubResource( 11 )
text = "Taurus IV"
__meta__ = {
"_edit_use_anchors_": false
}

[node name="description" type="RichTextLabel" parent="info"]
modulate = Color( 1, 1, 1, 0 )
margin_left = 27.0
margin_top = 621.0
margin_right = 990.0
margin_bottom = 883.0
focus_mode = 2
mouse_filter = 2
custom_fonts/normal_font = SubResource( 12 )
bbcode_enabled = true
bbcode_text = "Get some energy"
text = "Get some energy"
scroll_active = false
scroll_following = true
selection_enabled = true
__meta__ = {
"_edit_use_anchors_": false
}
